# Redis八股

[toc]

## 基础

### begin

#### 什么是Redis

* Redis是一种基于**内存**的数据库，对数据的读写操作都是在内存中完成，因此读写速度非常快，常用于**缓存cache**，**消息队列mq**、**分布式锁**等场景。最热门的NoSQL之一
* Redis提供了多种数据类型来支持不同的业务场景，并且**对数据类型的操作都是原子性**的，因为执行命令由单线程负责的，**不存在并发竞争的问题**
* Redis还支持**事务、持久化、Lua脚本、多种集群方案（主从复制模式、哨兵模式、切片机群模式）、发布/订阅模式，内存淘汰机制、过期删除机制**等等。

#### 为何要用Redis作为MySQL的缓存

源于：**高性能**和**高并发**两种特性

* 高性能：首次通过mysql从磁盘读取，很慢，缓存到redis后相当于直接操作内存，很快
* 高并发：单台设备的**Redis的QPS(Query Per Second)是mysql的10倍**，**redis单机的QPS可轻松突破10w，而mysql单机QPS很难超过1w**；故而直接访问redis可承受的请求远超过mysql

### Redis数据结构

#### Redis数据结构及使用场景

* 常见的有五种数据类型
  * String类型的应用场景：缓存对象、常规计数、分布式锁、共享 session 信息等
  * List类型的应用场景：消息队列（但是有两个问题：1. 生产者需要自行实现全局唯一 ID；2. 不能以消费组形式消费数据）等。
  * Hash类型：缓存对象、购物车等。
  * Set类型：聚合计算（并集、交集、差集）场景，比如点赞、共同关注、抽奖活动等。
  * Zset类型：排序场景，比如排行榜、电话和姓名排序等。
* 新版本新增四种
  * 位图BitMap（2.2 版新增）：二值状态统计的场景，比如签到、判断用户登陆状态、连续签到用户总数等
  * HyperLogLog（2.8 版新增）：海量数据基数统计的场景，比如百万级网页 UV 计数等；
  * 地理空间GEO（3.2 版新增）：存储地理位置信息的场景，比如滴滴叫车；
  * 消息队列Stream（5.0 版新增）：消息队列，相比于基于 List 类型实现的消息队列，有这两个特有的特性：自动生成全局唯一消息ID，支持以消费组形式消费数据。

![picture 4](../images/b8d6ec9aa02b299d1cb9740d1c661e91488b27ba826975f10ef661b1a231f8fe.png)  

#### 实现方式

暂略

### Redis线程模型

#### Redis是单线程吗

Redis单线程指的是==接收客户端请求->解析请求 ->进行数据读写等操作->发送数据给客户端这个过程是由一个线程（主线程）来完成的==，这也是我们常说 Redis 是单线程的原因。

> 但是，Redis 程序并不是单线程的，Redis 在启动的时候，是会启动后台线程（BIO）的：包括一个关闭文件线程、AOF刷盘线程和一个lazyfree线程

