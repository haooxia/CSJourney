# 计算机组成原理笔记

[toc]

## 一、概述

1. 冯诺依曼机的特点？

   1. 五个组成部分：运算器、控制器、存储器、输入设备、输出设备。
   2. 数据和指令以同等的地位存储在主存储器当中
   3. 指令和数据均用二进制代码表示，可按时间和地址区分
   4. 指令由操作码和地址码组成，操作码表示操作性质，地址码表示操作数所在位置
   5. 指令以顺序存放的。
   6. 早期冯诺依曼机以运算器为中心。

2. 什么是“存储程序”

   程序在运行前，都先存在主存储器当中，按照其在程序中的首地址执行第一条指令，然后就按照该程序规定的顺序执行其它指令，顺序程序结束。

3. **主存结构**
   1. MAR（地址寄存器存放方寸地址，位数对应存储单元的个数）
   2. MDR（数据寄存器暂存从存储器中读或写的信息，位数等于存储字长）
   3. 存储体（存放二进制信息，存储体由存储单元（由存储元件组成）组成）。

4. CPU结构：

   1. 运算器Arithmetic unit：负责算数运算和逻辑运算,ALU（算术(Arithmetic)逻辑单元，运算器的核心）累加器ACC 乘商寄存器MQ（Multiply Quotient register） 通用寄存器组 移位器 计数器 变址寄存器IX(index) 基址寄存器BR 程序状态字寄存器PSW（Program State Word register）
   2. 控制器controller：
      1. 程序计数器PC（存放当前欲执行指令的地址，可自动加一形成下一条指令的地址，送到MAR）
      2. 指令寄存器IR（存放当前的指令，来自MDR，指令的操作码送到CU，地址码送到IR，用以取地址）
      3. 控制单元CU（指令译码器，时序系统，微操作信号发生器，线代有MAR MDR）

5. 计算机工作的步骤？
   1、把指令和程序装入主存储器

   2、从程序的首地址运行程序（第一条指令的地址置于PC）

   3、取出第一条指令（PC->MAR->M->MDR->IR），然后分析指令（OP(IR)->CU）、执行指令(AD(IR)->MAR->M->MDR->ACC)，完成这条指令后，计算下一条指令的地址。

   4、用新得到的指令地址，继续读取第二条指令执行。每条指令都是取指、译码、执行直到结束。

6. 语言

   1. 机器语言：纯二进制，机器唯一可以直接识别执行的语言
   2. 汇编语言：用单词充当助记符的机器语言。需汇编程序将其转化为机器语言
   3. 高级语言：需编译程序编译成汇编语言

7. 各种程序
   1. 汇编程序：将**汇编**语言翻译成**机器**语言的程序。
   2. 翻译程序：将**高级**语言翻译成如**汇编**语言和**机器**语言这样的程序。翻译程序包括，编译程序和解释程序。
   3. 编译程序：是将源代码**一次全部**翻译成目标代码的程序，它将一种代码文件翻译成另一种代码文件，如果源代码不修改，则不用重新编译。eg C C++
   4. 解释程序，是将源代码的**一条语句**翻译成机器代码，并立即执行。解释执行是，翻译一条源代码就执行一条，适合调试程序时使用。 eg Python JavaScript MATLAB

8. 字长
   1. 机器字长:计算机能直接处理的二进制数据的位数，一般等于内部寄存器的大小，它决定了计算机运算的精度
   2. 指令字长:是一个指令中包含的二进制代码的位数
   3. 存储字长:是一个存储单元包含的二进制代码的位数
   4. 指令字长:一般是存储字长的整数倍

## 二、数据的表示和运算

   1. ASCII码：国际上用7位二进制码标识一个ASCII码，包括数字、字符、还有不可印刷的字符。

   2. 大端模式：大人高，先存高位有效字节，再存低位有效字节。与人类习惯顺序相同

   3. 常用校验码：奇偶校验码、汉明码、CRC循环码

   4. 解释各种机器数表示法的其含义表示的范围
      1. 原码：简单直观的机器数表示法。原码的0有两种表示方法
      2. 补码：正数表示和原码相同，负数等于原码的数值位取反再+1，补码加减法操作简单，0的表示唯一。
      3. 反码：正数表示和原码相同，负数等于原码的数值位取反。
      4. 移码：常用来表示浮点数的阶码 ，它只能表示整数。移码保持了数据的顺序，便于比较大小。移码全0表示最小真值0，全1表示最大真值max

   5. 溢出的三种判别方法
      1. 采用溢出逻辑表达式
      2. 双符号位法。01正溢出、10负溢出
      3. 一位符号位判别法。如果符号位进位和最高数位相同，就没有溢出

   6. IEEE754：float有1位符号位，8位阶码，23位尾数，偏置值为127;double有1位符号位，11位阶码，52位尾数，偏置值为$2^{10}-1$;

   7. 浮点数加减法：对阶（小阶向大阶看齐）、尾数求和、规格化、舍入

   8. 强制类型转化规则
      char->int->long->float->double，float->double最常见，转化过程没有损失。
      int转float可能有精读损失，int的32位全部用于表示数值，float有24位描述数值。

## 三、存储系统

1. 随机存储器RAM：任何一个单元都能随机存取，存取时间与存储单元的位置无关。主要用途是高速缓存或主存。**断电易失**。

   1. 静态SRAM（双稳态触发器）：贵，断电易失，非破坏性读出。无需刷新；Cache和主存由SRAM制成。
   2. 动态DRAM（栅极电容）：便宜，断电易失，破坏性读出，需要刷新、再生，采用地址复用技术。主存由DRAM制成。

   只读存储器ROM：数据一次写入存储器后不能修改，只能读取，断电**非易失**。通常用来存储不变的常数、程序。ROM和RAM一起作为主存的一部分。

   串行访问存储器：对存储单元的读写要按照**物理位置的先后顺序寻址**。它包括顺序存取存储器（eg 磁带）和直接存取存储器（eg 磁盘）。

2. 多级存储系统：为了解决存储系统大容量、高速度、低成本三者的矛盾。

   从上至下：CPU->Register->Cache->主存->磁盘->磁带（光盘）

3. **时间局部性**：程序当前运行的指令或用到的数据，**在不久也可能会用到**。因为程序有循环结构。

   **空间局部性**：某个存储单元被访问，接下来它**临近的存储单元也可能被访问**。因为指令是顺序存放的，数组等数据结构所占的存储空间也是连续的。

4. 主存容量扩展方法（存储容量 = 存储字数(表示存储器的地址空间大小) * 存储字长(表示一次存取操作的数据量) ）
   1. 位扩展法（存储字长变大），使其数据位数与CPU的数据线数相同；
   2. 字扩展法（存储字数变大），高位作为片选线；
   3. 字位同时扩展法。

5. cache和主存的映射方法：

   1. 直接映射：只能放在固定位置，命中率最低；主存字块标记 + Cache字块标记 + 字块内地址；
   2. 全相联映射：随便放，命中率最高
   3. 组相联映射：能放在特定分组的随意位置

6. Cache中主存块的替换算法：
   随机替换算法Random、先进先出替换算法FIFO、近期最少使用替换算法LRU、最不经常使用替换算法LFU。

7. cache写策略：

   1. 写命中：写直通法、写回法（只在淘汰Cache块时才写回，降低开销，但data不同步）
   2. 写不命中：写分配法、非写分配法

8. 虚拟存储器和Cache的相同点和不同点
   相同点：1、为了提升系统性能。2、把整个存储器，划分为小的数据块，作为基本的交换单位。3、都有地址映射、替换算法、更新策略等问题。4、都是依据局部性原理，将使用频率高的数据放入高速部件中。

   不同点：1、Cache主要解决访问速度问题，虚拟存储解决主存容量问题。2、Cache全部由硬件实现，对程序员是透明的；虚拟存储器由操作系统和硬件共同实现，对系统程序员不透明、对应用程序员透明。3、不命中时，虚拟存储器不命中时对系统效率影响更大。
9. Cache存主存块的副本数据，TLB存页表项的副本数据；

## 四、指令系统

0. 指令长 = 操作码 + 寻址特征 + 形式地址
1. **什么是指令？**
   指令是计算机执行某种操作的命令，是计算机运行的最小功能单位。指令包括操作码和地址码。操作码是识别指令、了解指令功能的关键信息。地址码指出被操作信息的地址。

2. 数据按边界对齐和不按边界对齐的区别
   1. 数据按边界对齐时，无论数据的大小是字、字节、半字，都可以一次访存取出。虽然浪费了一定的存储空间，但可以提高取数据的速度。

   2. 不按对齐的方式存储，虽然提高了存储空间的利用效率，但是字长和半字长的数据容易存储在两个存储单元上，这样取数据的时候就好两次访存，还要调整高低字节的位置.

3. 寻址
   1. **相对寻址**：相对寻址是把PC内容加上形式地址A而形成操作数的有效地址。形式地址用补码表示。优点：操作数的地址不是固定的，它随着PC的值变化而变化，便于代码在程序内部的浮动。相对寻址广泛应用于转移指令。EA = (PC) + A

   2. **基址寻址**：基址寄存器BR的内容加上形式地址A而形成的操作数的有效地址。基址寄存器内容不变而形式地址可变。便于程序浮动，有利于多道程序设计。基址寻址面向os；EA = (BR) + A

   **变址寻址**：形式地址A加上变址寄存器的内容就是有效地址的内容。在程序执行过程中，形式地址不变，寄存器的数值不断改变，非常适合编写循环程序。变址寻址面向用户；EA = A + (IX)

4. CISC: 复杂；大于200条指令；指令字长不固定；微程序控制；X86

   RISC: 简单；小于100条指令；定长指令字长；只有load和store指令可访存；寄存器数量较**多**；组合逻辑控制；必须实现指令流水线；ARM和MIPS

## 五、CPU

1. 指令周期：CPU从主存中每取出和执行一条指令所需的全部时间称为指令周期。指令周期由机器周期组成，机器周期由时钟周期组成。指令周期可分为：取指周期、间址周期（取有效地址）、执行周期（取操作数）、中断周期（保存程序断点）。每个周期都有访存，只是目的不同。间址周期是为了取操作数的有效地址，执行周期是为了取操作数。
2. 计算机如何区分指令和数据
   从时间上讲取指令时间发生在取值周期，取数据阶段发生在执行周期；
   从空间上讲，指令取出送入控制器，数据取出送入运算器。

3. 周期
   1. **指令周期**是指CPU取出并执行一条指令所需要的时间；

   2. **机器周期**是在同步控制的机器中，执行指令周期中一步相对完整的操作所需的周期时间。

   3. **时钟周期**是指计算机主时钟的周期时间，它是计算机运行时最基本的时序单位。对应一个微操作所需的时间。

4. **硬布线控制器**：微操作控制信号由组合逻辑电路根据当前的操作码、时序和状态即时产生；RISC的cpu中;难扩充；繁琐；执行速度快；

   **微程序控制器**：微操作控制信号以微程序的形式存放在控制存储器中，执行指令时读出即可；cisc的cpu中
   一个指令对应一个微程序，微程序由多条微指令组成的，微指令转化成电路信号来操作各个部件，就是微命令。

5. **指令流水线**：将一条指令分为多个子过程，每个子过程与其它的子过程并行执行，以提高计算机吞吐率的手段。只需要少量的硬件，就可以使计算机的运行速度提高好几倍。是计算机经常使用的并行处理技术。

6. 影响流水线的因素：
   1. **数据相关**：在程序中，存在必须等待前一条指令执行完，才能执行后面一条指令的情况。解决方法：数据旁路技术；让后一条指令停会；

   2. **结构相关**：多条指令在同一时刻争用同一资源而形成的冲突称为结构相关。解决办法：后一条指令暂停一个时钟周期。资源重复配置（如数据cache和指令cache）

   3. **控制相关**：当流水线遇到转移指令和其它改变PC值的指令而造成的断流，会引起控制相关。解决办法：1、对转移指令进行分支预测，更好生成转移目标地址。2、取转移成功和不成功两个方向上的目标指令。
7. 总线
   1. 片内总线：cpu内
   2. 系统总线：功能部件间，分为数据总线、地址总线和控制总线
   3. 通信总线
